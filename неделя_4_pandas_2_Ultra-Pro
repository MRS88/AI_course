'''Задача 1
Подгрузите данные 'data.csv' (возможно, придется указать кодировку encoding сp1250) в переменную data.
Создайте новый столбец TotalCost со значениями Quantity * UnitPrice. 
Сделайте resampling данных в еженедельные со значениями суммы по столбцам TotalCost.'''

import pandas as pd

data = pd.read_csv('/content/data.csv', encoding='cp1250')
data['TotalCost'] = data.Quantity * data.UnitPrice
data.index = pd.to_datetime(data.InvoiceDate)
data.drop('InvoiceDate', axis=1, inplace=True)
data.TotalCost.resample('W').sum()
#data.TotalCost.resample('M').sum()
data.head()


'''Задача 2
Посчитайте скользящее недельное среднее суммы ежедневных заказов. Для этого
сделайте resampling в ежедневные данные,
посчитайте скользящее среднее за 7 дней по столбцу TotalCost.
Для решения второй части данной задачи потребуется самостоятельно найти способ определения скользящего среднего.'''

res_df = data.TotalCost.resample('D').sum()
res_df.rolling(window=7).mean()


'''Задача 3. GroupBy
Посчитайте общую стоимость заказов на ежемесячной основе в разбивке по странам.'''

month = data.TotalCost.resample('M').sum()
data.groupby(['Country', pd.Grouper(freq='MS')])['TotalCost'].sum()


'''Задача 4. JOIN
Подгрузите данные, содержащие информацию о номерах карт лояльности пользователей (card_data.csv).
Назовите ее cards.
Сделайте Left Join исходной таблицы (которая получилась после задачи с datetime индексом) и таблицы cards.
Если будет переполнение памяти, попробуйте взять не все значения таблицы, а, например, первые 100 с помощью соответствующего метода iloc.'''

cards = pd.read_csv('/content/card_data.csv')
data_1 = data.iloc[:100].merge(cards.iloc[:100], on='CustomerID', how='left')


'''Задача 5
Выведите квантили 0.4 и 0.6 по численным данным новой таблицы там, где это имеет смысл.'''

data_1.quantile([0.4, 0.6])
